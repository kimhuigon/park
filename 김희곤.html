<body>
    <div id="map" style="width:500px;height:400px; margin-left: 50%; transform: translateX(-50%); margin-top: 100px;">
    </div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=41ce8b9519ec9b48b457759b6dff0a54"></script>
    <script>
      const imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";
  
      get(); // 호이스팅 hoisting
  
      async function get() {
        const url = 'parkdata.json';
        const res = await fetch(url);
        const data = await res.json();
        const list = data.records;
        
        // 현재 위치 가져오기
        navigator.geolocation.getCurrentPosition((pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const container = document.getElementById('map');
          const options = {
            center: new kakao.maps.LatLng(lat, lng),
            level: 3
          };
  
          const map = new kakao.maps.Map(container, options);
  
          // 현재 위치에 마커 추가
          const markerPosition = new kakao.maps.LatLng(lat, lng);
          const marker = new kakao.maps.Marker({
            position: markerPosition
          });
          marker.setMap(map);
  
          // 공원의 커스텀 마커 이미지 설정
          const markerImage = new kakao.maps.MarkerImage(imageSrc, new kakao.maps.Size(24, 35));
  
          // parkdata.json의 각 공원에 대해 마커 추가
          list.forEach((v) => {
            const name = v.공원명;
            const lat = v.위도;
            const lng = v.경도;
            const markerPosition = new kakao.maps.LatLng(lat, lng);
  
            const marker = new kakao.maps.Marker({
              position: markerPosition,
              image: markerImage
            });
            marker.setMap(map);
  
            // 마커에 인포윈도우 추가
            const infowindow = new kakao.maps.InfoWindow({
              content: `<div style="padding:5px;">${name}</div>`
            });
  
            kakao.maps.event.addListener(marker, 'mouseover', () => {
              infowindow.open(map, marker);
            });
  
            kakao.maps.event.addListener(marker, 'mouseout', () => {
              infowindow.close();
            });
          });
        });
      }
    </script>
  </body>
  